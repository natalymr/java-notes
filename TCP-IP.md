
## Ликбез по сетям :rocket:

> #### TCP/IP
> TCP/IP — сетевая модель передачи данных, представленных в цифровом виде.
> Модель описывает способ передачи данных от источника информации к получателю.
> В модели предполагается прохождение информации через четыре уровня,
> каждый из которых описывается правилом (протоколом передачи).
> Наборы правил, решающих задачу по передаче данных, составляют стек
> протоколов передачи данных, на которых базируется Интернет.
> Название TCP/IP происходит из двух важнейших протоколов семейства —
> **Transmission Control Protocol** (TCP, протокол управления передачей)
> и **Internet Protocol** (IP, интернет-протокол),
> которые первыми были разработаны и описаны в данном стандарте.
>
> Набор интернет-протоколов обеспечивает сквозную передачу данных,
> определяющую, как данные должны пакетироваться, обрабатываться,
> передаваться, маршрутизироваться и приниматься.
> Эта функциональность организована в четыре слоя абстракции,
> которые классифицируют все связанные протоколы в соответствии
> с объемом задействованных сетей. От самого низкого до самого
> высокого уровня - это уровень связи, содержащий методы связи для данных,
> которые остаются в пределах одного сегмента сети (ссылка);
> интернет-уровень, обеспечивающий межсетевое взаимодействие между
> независимыми сетями; транспортный уровень, обрабатывающий связь между хостами;
> и прикладной уровень, который обеспечивает обмен данными между процессами для приложений.
> ##### Уровни стека TCP/IP
> Стек протоколов TCP/IP включает в себя четыре уровня
> *  Прикладной уровень (Application Layer)
> *  Транспортный уровень (Transport Layer)
> *  Межсетевой уровень (Сетевой уровень) (Internet Layer)
> *  Уровень доступа к сети (Network Access Layer)
>
> На стеке протоколов TCP/IP построено всё взаимодействие пользователей в IP-сетях.
> Стек является независимым от физической среды передачи данных, благодаря чему,
> в частности, обеспечивается полностью прозрачное взаимодействие между проводными
> и беспроводными сетями.
>
> Уровень | Протоколы | Описание
> --------|-----------|---------
> Application | http, ftp, ssh | На данном уровне работает большинство сетевых приложений. Эти программы имеют свои собственные протоколы обмена информацией, например, интернет браузер для протокола HTTP, ftp-клиент для протокола FTP (передача файлов), почтовая программа для протокола SMTP (электронная почта), SSH (безопасное соединение с удалённой машиной), DNS (преобразование символьных имён в IP-адреса) и многие другие.
> Transport | TCP, UDP | Протоколы транспортного уровня (Transport layer) могут решать проблему негарантированной доставки сообщений («дошло ли сообщение до адресата?»), а также гарантировать правильную последовательность прихода данных. В стеке TCP/IP транспортные протоколы определяют, для какого именно приложения предназначены эти данные.
> Network | IP, ICMP, IC-MP | Межсетевой уровень (Internet layer) изначально разработан для передачи данных из одной сети в другую. На этом уровне работают маршрутизаторы, которые перенаправляют пакеты в нужную сеть путем расчета адреса сети по маске сети. С развитием концепции глобальной сети в уровень были внесены дополнительные возможности по передаче из любой сети в любую сеть, независимо от протоколов нижнего уровня, а также возможность запрашивать данные от удалённой стороны
> Link | ARP, Ethernet, Wi-Fi | Канальный уровень (Link layer) описывает способ кодирования данных для передачи пакета данных на физическом уровне (то есть специальные последовательности бит, определяющих начало и конец пакета данных, а также обеспечивающие помехоустойчивость). Ethernet, например, в полях заголовка пакета содержит указание того, какой машине или машинам в сети предназначен этот пакет. Кроме того, канальный уровень описывает среду передачи данных (будь то коаксиальный кабель, витая пара, оптическое волокно или радиоканал), физические характеристики такой среды и принцип передачи данных (разделение каналов, модуляцию, амплитуду сигналов, частоту сигналов, способ синхронизации передачи, время ожидания ответа и максимальное расстояние).

### Уровень Network
#### IP-адрес
Для того, чтобы общаться по сети, необходимо знать адрес того, с кем общаешься.
У каждого есть такой адрес, IP-адрес (Internet Protocol). Он занимает 4 байта. Обозначается `IPv4`.

Пример: IP-адрес `spbau.ru` - `194.85.238.98`.

Для всех устройств количество различных IP-адресов не хватает.

>_Есть запрещенные для использования IP-адреса, каждый из них подходит под один из паттернов:_
> * `192.169.*.*`
> * `10.*.*.*`
> * `172.*.*.*`
> * _и еще несколько паттернов_

Для чего нужно было вводить запрещенные на использования IP-адреса, если их и так не всем хватает?

В связи с проблемой нехватки IP-адресов было решено ввести
механим различия передачи данных по локальной сети _(например, планшет-роутер)_
и по внешней сети _(например, планшет-`vk.com`)_.
Поэтому для общения по локальной сети используются IP-адреса из запрещенного диапазона.
> Они могу называться внутренними, внутрисетевыми, локальными или «серыми».
>
> Англиский вариант - private IP adress

Когда Igor через планшет хочет выйти в интернет, роутер преобразует IP-адреса локальной
сети в свой IP-адрес. Со стороны внешнего мира кажется, что пакеты идут не от планшета,
а от роутера.

> Пакеты с разных устройств поступают на роутер, после чего адреса их отправителей подменяются на один общий.
> Когда приходит ответ на запрос, адрес подменяется обратно и ответ приходит тому, кому надо.
> Этот механизм называется **NAT** (Network Address Translation).
>
>В реальности пользователь подключен к провайдеру, который может быть подключен к
более общему провайдеру, итд. Тогда при передаче пакета, IP-адрес может заменяться несколько
раз. Можно у провайдера купить ”белый” IP-адрес, который можно использовать в интернете,
и он подменяться не будет.
>
>Наряду с 4-байтовым протоколом IPv4, есть протокол IPv6. В нем адрес занимает 16 бай-
тов, и таких адресов хватит на всех. Но этот протокол не поддерживается почти никакими
провайдерами.

#### Mask

У каждого устройства в сети есть еще и маска. Она также, как и IP-адрес, занимает 4 байта.
Всегда маска устроена следующим образом: сначала идет определенное число единиц, а оставшееся
место занимают 0.

Маску можно записывать следующими способами:
1. либо в десятичной системе счисления через 4 числа - `255.255.254.0`
2. либо приписывать к IP-адресу количество единиц - `194.85.248.10/24`

Маску используют чтобы определить, лежат ли два устройства в одной сети. Для этого
Считают побитовые & адресов с маской и сравнивают результаты.

#### Gateway

#### Common
> Наряду с 4-байтовым протоколом `IPv4`, есть протокол `IPv6`. В нем адрес занимает 16 бай-
тов, и таких адресов хватит на всех. Но этот протокол не поддерживается почти никакими
провайдерами.
>
> Рассмотрим подробнее, как устроено облачко. От коробочки с антеннами идет провод к
маршрутизатору, общему на один дом. От него идет провод к центральному маршрутизатору
в районе, итд. У каждого маршрутизатора в этой цепочке есть IP-адрес, маска и шлюз. Когда
приходит пакет, маршрутизатор смотрит адрес получателя. Если этот адрес лежит с ним в
одной сети, пакет отправляется по адресу. Иначе пакет через шлюз отправляется на следующий
маршрутизатор более глобальной сети.
>
>Когда запрос Алисы пришел на сервер ВК, тот формирует ответ и хочет его отправить
обратно Алисе. Для этого ему нужен её IP-адрес. Этот адрес был отправлен вместе с запросом.
Не забываем, что при передаче запроса, IP-адрес отправителя может меняться.
>
> Таким образом, на уровне **Network** внешняя обертка содержит **IP1** – адрес отправителя и
**IP2** – адрес получателя.


### Уровень Link







